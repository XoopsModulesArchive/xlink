<?php//  -------------------------------------------------------------------------- ////  [CONTENT RELATIONS MGR FOR XOOPS-R2]//  Author: Toms Veilands [tomsys@tomsys.net] [www.tomsys.net] [AKA tomsys]//  Credits: Xoops Team [www.xoops.org]//  Version: 1.0//  ReleaseDate: May 03, 2003//  License: GPL - [http://www.gnu.org/licenses/gpl.html]//  -------------------------------------------------------------------------- //function xlink_admin_block_show() {//please adapt - bitte bearbeiten	global $xoopsDB, $xoopsUser, $xoopsModule, $xoopsConfig, $storytopic, $storyid, $articleid, $category, $forum, $cat, $album, $page, $cid, $lid, $_SERVER, $xoopsOption, $pop, $rows, $link_old_title, $link_title, $link_id, $moduleid, $link_row;//adaptation end - bearbeitung ende		$isadmin  = !isset($xoopsUser) ? intval($xoopsUser->isAdmin()) : 0;	$moduleid = isset($xoopsModule) ? intval($xoopsModule->mid()) : "";		$myurl    = $_SERVER['PHP_SELF'];	$myurl   .= !empty($_SERVER['QUERY_STRING']) ? "?".$_SERVER['QUERY_STRING'] : "";	$block    = array(); if (!defined('XOOPS_ROOT_PATH') || !is_object($xoopsModule)) {	return;}$xoopsMod =& XoopsModule::getByDirname("xlink");if ( !$xoopsUser->isAdmin($xoopsMod->mid()) ) {	redirect_header(XOOPS_URL."/",3,_NOPERM);	exit();} else {//start/////////////////////////////// FORM REQUESTS START ///////////////////////////////////	if (!empty($HTTP_GET_VARS)) {//	extract($HTTP_GET_VARS);//	}	//	if (!empty($HTTP_POST_VARS)) {//	extract($HTTP_POST_VARS);//	}	//	if (!empty($HTTP_SERVER_VARS)) {//	extract($HTTP_SERVER_VARS);//	} $pop = '';foreach ($_POST as $k => $v){    ${$k} = $v;}foreach ($_GET as $k => $v){    ${$k} = $v;}if (isset($_POST['pop'])) {	$pop = trim($_POST['pop']);}if (!empty($pop)) {	  /////////////////////////////////////////	 // Quickupdate for Temp. bookmars form //------>	//------>	if ($pop == 'bquickupdate') { // Quick update bookmark names		$count = $rows;				for ( $r = 0; $r < $count; $r++ ) {											if ( $link_old_title[$r] != $link_title[$r]) {				 $sql = "UPDATE ".$xoopsDB->prefix('xlink_tmpuri')." SET title='".$link_title[$r]."' WHERE recid='".$link_id[$r]."'";				 $res = $xoopsDB->query($sql); //sorry no testing here yet			}		}		redirect_header($HTTP_REFERER, 1, _MB_XLINK_SUCC);	}		  /////////////////////////////////////////////////	 // Insert new bookmark for Temp. bookmars form //------>	//------>	if ($pop == 'add_bookmark') { // Insert new bookmark				$sql = "INSERT INTO ".$xoopsDB->prefix("xlink_tmpuri")." VALUES (NULL, $moduleid, '$myurl', 0, '"._MB_XLINK_NULINK."')";		if ($xoopsDB->queryF($sql)) {			redirect_header($HTTP_REFERER, 1, _MB_XLINK_SUCC);		} else {			redirect_header($HTTP_REFERER, 1, _MB_XLINK_FAILURE);		}	}		  //////////////////////////////////	 // Remove all bookmarks WARNING //------>	//------>	if ($pop == 'drop_all_bookmarks') { // Remove all bookmarks		$block['AdminBlock'] = "			<table width='1px' cellspacing='0' cellpadding='0' align='center'>			<tr>			<td align='center'>			<h4>      "._MB_XLINK_RUSURE."      </h4>			<div >									"._MB_XLINK_ALLBOOKREMOV."      <br />			"._MB_XLINK_PLZCONF."      <br />      <br />			</div>									</td>			</tr>			<tr>			<td align='center'>      <form name='dropallbkms' method='post' style='border:0px;padding:0px;'>			<input type='hidden' name='pop' value='remove_all_bookmarks_ok' />			<input type='submit' value=' "._MB_XLINK_YES." ' style='border: #ee0000 1px solid; font: 10px verdana, arial, helvetica, sans-serif; background-color: #ee0000; color:#FFFFFF; font-weight:bold;' />			<input type='button' value=' "._MB_XLINK_NO." ' onclick='location='".$HTTP_REFERER."'' style='border: #336699 1px solid; font: 10px verdana, arial, helvetica, sans-serif; background-color: #336699; color:#FFFFFF; font-weight:bold;' />			</form>			</td>			</tr>			</table>		";		return $block;	}	  //////////////////////////////////	 // Remove all bookmarks Proceed //------>	//------>	if ($pop == 'remove_all_bookmarks_ok') { // Remove all bookmarks			$sql = "DELETE FROM ".$xoopsDB->prefix('xlink_tmpuri')."";			$success1 = $xoopsDB->query($sql) ? 1 : 0; 			$sql = "DELETE FROM ".$xoopsDB->prefix('xlink')."";			$success = $xoopsDB->query($sql) ? 1 : 0;			$sql = "DELETE FROM ".$xoopsDB->prefix('xlink_uri')."";					if($xoopsDB->query($sql) && $success && $success1){			redirect_header($HTTP_REFERER, 1, _MB_XLINK_SUCC);		} else {			redirect_header($HTTP_REFERER, 1, _MB_XLINK_DELFAILURE);		}		}}///////////////////////////////// END FORM REQUESTS ///////////////////////////////////end//---------------------------------------------------------------------------------//start/////////////////////////////// BLOCK CONTENT START /////////////////////////////////	  /////////////////////////////////////////////////		 // Module information section, value gathering //------>	//------>	//please adapt - bitte bearbeiten	$recognized = "";	$recognized .= isset($xoopsModule) ? ""._MB_XLINK_ID."".intval($xoopsModule->mid())." (".$xoopsModule->name().")"."<br />" : "";	$recognized .= isset($storytopic)  ? ""._MB_XLINK_TOPICID."".$storytopic."<br />" : "";	$recognized .= isset($storyid)     ? ""._MB_XLINK_STORYID."".$storyid."<br />" : "";	$recognized .= isset($cid)         ? ""._MB_XLINK_CID."".$cid."<br />" : "";	$recognized .= isset($category)    ? ""._MB_XLINK_CATEGORYID."".$category."<br />" : "";	$recognized .= isset($forum)       ? ""._MB_XLINK_FORUM."".$forum."<br />" : "";	$recognized .= isset($articleid)   ? ""._MB_XLINK_ARTICLEID."".$articleid."<br />" : "";	$recognized .= isset($cat)         ? ""._MB_XLINK_CAT."".$cat."<br />" : ""; $recognized .= isset($album)        ? ""._MB_XLINK_ALBUM."".$album."<br />" : "";//adaptation end - bearbeitung ende	  //////////////////////////////////     // Temporary bookmark list Form //------>	//------>				$tmpuri = "";	$sql = "SELECT * FROM ".$xoopsDB->prefix('xlink_tmpuri')." ORDER BY 'modid','recid' ASC";	$result = $xoopsDB->query($sql); // error check, not implemented yet....	$row = 0;	while ($myrow = $xoopsDB->fetchArray($result)) {				$tmpuri .= "<tr><td align='right'><input type='hidden' name='link_row' value='".$row."' />"				  ."<input type='hidden' name='urid[$row]' value='".$myrow['urid']."' />"				  ."<input type='hidden' name='link_old_title[$row]' value='".$myrow['title']."' />"				  ."[".$myrow['modid']."]&nbsp;</td><td align='left' width='1px'><input type='text' name='link_title[$row]' value='".$myrow['title']."' size='60' maxlength='120' /></td>"				  ."<td align='left'><input type='hidden' name='link_id[$row]' value='".$myrow['recid']."' /><a href='".$myrow['url']."' title='".$myrow['url']."'><img hspace='2' align='top' src='".XOOPS_URL."/modules/xlink/images/link.gif' border='0' /></a>"				  ."<a href='".XOOPS_URL."/modules/xlink/dropsinglebookmark.php?link_id=".$myrow['recid']."' title='"._MB_XLINK_REMBM."'><img align='absmiddle' src='".XOOPS_URL."/modules/xlink/images/remove.gif' border='0' /></a>"				  ."<a href='".XOOPS_URL."/modules/xlink/addbookmark.php?link_url="				  				.rawurlencode($myrow['url'])								."&amp;link_title=".rawurlencode($myrow['title'])//please adapt - bitte bearbeiten								."&amp;module_id=". $moduleid								."&amp;topic_id=". $storytopic								."&amp;story_id=". $storyid								."&amp;article_id=". $articleid								."&amp;xlinkcategory_id=". $category								."&amp;xlinkforum_id=". $forum								."&amp;xlinkcat_id=". $cat								."&amp;xlinkalbum_id=". $album								."&amp;dc_id=". $cid//adaptation end - bearbeitung ende																."&amp;home_url=". rawurlencode($myurl)								."' 								title='"._MB_XLINK_BMINUB."'><img hspace='2' align='absmiddle' src='".XOOPS_URL."/modules/xlink/images/paste.gif' border='0' /></a></td>";		 $tmpuri .=	!empty($myrow['urid']) ? "<td align='left'>&nbsp;"											."&nbsp;</td></tr>"		 									: "<td align='left'>&nbsp;</td></tr>";		 $row++;			}	$tmpuri = !empty($tmpuri) ? 				"<div align='center' style='border-top:1px solid #FF4466;padding:2px;'>					<form action='' method='post'><table align='center' width='50%' cellpadding='1px' cellspacing='1px'>".$tmpuri				  ."</table>				  	<input type='hidden' name='rows' value='$row' />					<input type='hidden' name='pop' value='bquickupdate' /><br />					<input type='submit' value='"._MB_XLINK_UPDATE."' />					<input type='reset'  value='"._MB_XLINK_RESET."' />					</form>						 </div>" : "";				 	  /////////////////////     // Menu bar string //------>	//------>	  $menubar  = "<table cellspacing='0' cellpadding='0' style='border-top:1px solid #FF4466;'>					     <tr>						   <td align='left'>               <form name='AddCurrentURL' method='post' style='margin:2px 10px 0px 10px;'>               <input type='hidden' name='pop' value='add_bookmark' />               <input type='submit' value='"._MB_XLINK_ADDURL."' style='border: #336699 1px solid; font: 10px verdana, arial, helvetica, sans-serif; background-color: #336699; color:#FFFFFF; font-weight:bold;' />               </form></td>";  $menubar .= !empty($tmpuri) ? "<td align='right'>               <form name='DelAllBookmarks' method='post' style='margin:2px 10px 0px 10px;'>               <input type='hidden' name='pop' value='drop_all_bookmarks' />               <input type='submit' value='"._MB_XLINK_REMOVEALL."' style='border: #ee0000 1px solid; font: 10px verdana, arial, helvetica, sans-serif; background-color: #ee0000; color:#FFFFFF; font-weight:bold;' />               </form></td>" : "";  $menubar .= "</tr></table>";	   	  ///////////////////     // Block Output  //------>	//------>			if (!empty($recognized)) { 				$block['AdminBlock'] = 					"<div style='padding:2px;'><strong>"._MB_XLINK_BINDVAL."</strong><br />"						.$recognized					."</div>" 					.$tmpuri									.$menubar;			} //unset($block['AdminBlock']); // Sorry folks,<br>can't make any<br>related links here.<br>	return $block;	}}///////////////////////////////// BLOCK CONTENT END /////////////////////////////////?>